define ("block_mootivated/store",["jquery","block_mootivated/appearance","block_mootivated/place-auction-bid","block_mootivated/image-popup","block_mootivated/purchase-confirmation"],function(a,b,c,d,e){var f=function(b,c,d){this.coins=b;this.returnto=c;this.cart=d;this.storeNode=a(".block_mootivated-items-list");this.toolsNode=a(".block_mootivated-page-nav .nav-tools-wrapper");this.init=this.init.bind(this);this.handleAddToCartClick=this.handleAddToCartClick.bind(this);this.handleBuyClick=this.handleBuyClick.bind(this);this.updateUiCartBtn=this.updateUiCartBtn.bind(this);this.updateUiCartCount=this.updateUiCartCount.bind(this);this.updateUiLockPurchase=this.updateUiLockPurchase.bind(this)};f.prototype.init=function(){var b=this;this.storeNode.on("click","button",function(c){c.preventDefault();var d=a(c.currentTarget),e=d.closest(".item-wrapper");if("cart"===d.data("action")){b.handleAddToCartClick(e)}else{b.handleBuyClick(e)}});this.storeNode.on("click",".item-image a",function(b){b.preventDefault();d.open(a(b.currentTarget).attr("href"))});this.storeNode.find(".item-has-variants").each(function(c,d){var e=a(d);b.handleVariantChange(e)});this.storeNode.find(".item-wrapper").each(function(c,d){var e=a(d);b.updateUiCartBtn(e)});this.storeNode.on("change",".variant-select",function(c){c.preventDefault();var d=a(c.target).closest(".item-wrapper");b.handleVariantChange(d)})};f.prototype.handleAddToCartClick=function(a){var b=this,c=new Date().getTime(),d=new Date(c+1e3);this.updateUiCartBtn(a,!0);return this.cart.addFromNode(a).then(function(){var c=new Date;setTimeout(function(){b.updateUiCartBtn(a,!1);b.updateUiCartCount()},Math.max(0,d.getTime()-c.getTime()))})};f.prototype.handleBuyClick=function(a){if(a.hasClass("item-auction")){var d={id:a.data("item-id"),hasbid:parseInt(a.data("item-hasbid"),10),cost:parseInt(a.data("item-cost"),10),auction_bid:parseInt(a.data("item-auction_bid"),10),minimum_bid:parseInt(a.data("item-minimum_bid"),10),handling_fee:parseInt(a.data("item-handling_fee"),10)},f=new c(d,this.coins,this.returnto,b.getSettings());f.show()}else{if(!a.data("item-id")||!a.data("item-buyurl")){return}var g={id:a.data("item-id"),cost:parseInt(a.data("item-cost"),10),name:a.data("item-name")},h=new e(g,a.data("item-buyurl"));h.show()}};f.prototype.handleVariantChange=function(a){var b=a.find(".variant-select"),c=b.val(),d=b.find(":selected");if(!c){a.data("item-buyurl","");a.data("item-id","");a.data("item-name","");a.data("item-numremaining","999")}else{a.data("item-id",c);a.data("item-buyurl",d.data("item-buyurl"));a.data("item-name",d.data("item-name"));a.data("item-numremaining",d.data("item-numremaining"))}this.updateUiLockPurchase(a,!c)};f.prototype.updateUiCartBtn=function(a,b){var c=a.data("item-id"),d=a.find(".add-to-cart-btn");if(b){d.find(".add-to-cart-label").hide();d.find(".add-to-cart-loading").show()}else{d.find(".add-to-cart-label").show();d.find(".add-to-cart-loading").hide();var e=a.data("item-numremaining"),f=this.cart.getQuantity(c);d.prop("disabled",!c||"undefined"!=typeof e&&f>=e)}};f.prototype.updateUiCartCount=function(){this.toolsNode.find(".shopping-cart-qty").text(this.cart.getQuantity())};f.prototype.updateUiLockPurchase=function(a,b){var c=a.find("button");if(b){c.prop("disabled",!0)}else{c.prop("disabled",!1);this.updateUiCartBtn(a)}};return f});
//# sourceMappingURL=store.min.js.map
